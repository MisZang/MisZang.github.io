<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>姜同学 - 在线简历</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #4a90e2;
            --secondary-color: #50e3c2;
            --background-color: #f4f7f6;
            --text-color: #333;
            --light-grey: #bdc3c7;
            --dark-grey: #2c3e50;
            --card-bg: #ffffff;
            --sidebar-bg: #2c3e50;
            --sidebar-text: #ecf0f1;
            --tag-bg: #e0e0e0;
            --tag-text: #555;
            --header-height: 60px; /* Base header height */
            --sidebar-width: 280px;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            display: flex;
            padding-top: 0;
        }

        h1, h2, h3 {
            color: var(--dark-grey);
            margin-bottom: 0.8em;
        }

        h2 {
            font-size: 1.6em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            display: inline-block;
            margin-bottom: 25px;
        }
        h2 i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        h3 {
            font-size: 1.3em;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        a {
            color: var(--primary-color);
            text-decoration: none;
            transition: color 0.3s ease;
        }

        a:hover {
            color: var(--secondary-color);
            text-decoration: underline;
        }

        ul {
            list-style: none;
            padding-left: 0;
        }

        li {
            margin-bottom: 10px;
        }

        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--sidebar-bg);
            color: var(--sidebar-text);
            padding: 30px 20px;
            position: fixed;
            top: 0;
            left: 0;
            height: 100vh;
            overflow-y: auto;
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .profile-pic-placeholder {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background-color: var(--light-grey);
            margin-bottom: 20px;
            overflow: hidden;
            border: 4px solid var(--secondary-color);
            flex-shrink: 0;
        }
        .profile-pic-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sidebar h1 {
            color: var(--sidebar-text);
            font-size: 1.8em;
            margin-bottom: 5px;
            text-align: center;
            flex-shrink: 0;
        }
        .sidebar h1#profile-home-link {
            position: relative;
            cursor: pointer;
            transition: color 0.3s ease;
        }
        .sidebar h1#profile-home-link:hover {
            color: var(--secondary-color);
        }
        .home-tooltip {
            position: absolute;
            bottom: 110%;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--secondary-color);
            color: var(--sidebar-bg);
            padding: 6px 12px;
            border-radius: 5px;
            font-size: 0.8em;
            white-space: nowrap;
            z-index: 10;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease, visibility 0s linear 0.3s;
            pointer-events: none;
        }
        .home-tooltip::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            border-width: 5px;
            border-style: solid;
            border-color: var(--secondary-color) transparent transparent transparent;
        }
        .home-tooltip.show {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.3s ease;
        }

        .job-title-sidebar {
            font-size: 0.95em;
            color: var(--light-grey);
            text-align: center;
            margin-bottom: 25px;
            line-height: 1.4;
             flex-shrink: 0;
        }

        .sidebar-info ul {
            padding-left: 5px;
        }

        .sidebar-info li {
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            font-size: 0.95em;
        }

        .sidebar-info i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            color: var(--secondary-color);
        }
         .sidebar-info li span,
         .sidebar-info li a {
             color: #bdc3c7;
             word-break: break-all;
         }
         .sidebar-info li a:hover {
             color: var(--secondary-color);
             text-decoration: none;
         }
         .sidebar-info strong {
             font-weight: 500;
             color: var(--sidebar-text);
         }
         .sidebar-wechat-trigger {
            cursor: pointer;
         }
         .sidebar-wechat-trigger:hover span {
             color: var(--secondary-color);
         }


        .main-content {
            flex-grow: 1;
            padding: 40px 50px;
            margin-left: var(--sidebar-width);
            background-color: var(--card-bg);
            min-height: 100vh;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.05);
        }

        .content-wrapper {
            max-width: 900px;
            margin: 0 auto;
        }

        .page-content { }


        .section {
            margin-bottom: 40px;
            padding: 30px;
            background-color: #fff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            border-left: 5px solid var(--primary-color);
        }
        .section:last-child {
             margin-bottom: 0;
        }

        .about p, .education p, .online-presence p {
            margin-bottom: 15px;
            font-size: 1.05em;
        }
         .about p:last-child, .education p:last-child, .online-presence p:last-child {
             margin-bottom: 0;
         }


        .skills-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .skill-category {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 5px;
        }

        .skill-category h4 {
            font-weight: 500;
            color: var(--dark-grey);
            margin-bottom: 15px;
            border-bottom: 1px solid var(--light-grey);
            padding-bottom: 5px;
        }

        .tags-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .tag {
            background-color: var(--tag-bg);
            color: var(--tag-text);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.9em;
            font-weight: 500;
            transition: background-color 0.3s, color 0.3s;
        }
        .tag.highlight {
             background-color: var(--primary-color);
             color: white;
        }
        .tag.engine {
             background-color: var(--secondary-color);
             color: var(--dark-grey);
        }
         .tag.tool {
             background-color: #f39c12;
             color: white;
         }
         .tag .remove-tag {
            margin-left: 5px;
            cursor: pointer;
            font-size: 0.8em;
            color: #777;
             transition: color 0.3s;
        }
         .tag .remove-tag:hover {
             color: var(--error-color);
         }
         .tag-input {
             flex-grow: 1;
             border: none;
             outline: none;
             padding: 5px;
             font-family: inherit;
             font-size: 0.9em;
              min-width: 100px;
         }
         .tag-input-container {
             display: flex;
             flex-wrap: wrap;
             gap: 10px;
             padding: 10px;
             border: 1px solid var(--light-grey);
             border-radius: 5px;
             margin-bottom: 10px;
             align-items: center;
         }


        .project {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px dashed var(--light-grey);
        }
        .project:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }

         .project ul {
             list-style: disc;
             padding-left: 20px;
             margin-bottom: 15px;
         }
         .project ul li {
             margin-bottom: 8px;
             line-height: 1.5;
         }
          .project p {
              margin-bottom: 15px;
          }


        .project-image-placeholder {
            width: 100%;
            height: 150px;
            background-color: var(--tag-bg);
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--tag-text);
            font-style: italic;
            margin-top: 15px;
            overflow: hidden;
        }
         .project-image-placeholder img {
             width: 100%;
             height: 100%;
             object-fit: cover;
         }


        .certifications ul li, .online-presence ul li {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        .certifications ul li i, .online-presence ul li i {
            margin-right: 10px;
            color: var(--primary-color);
            width: 20px;
            text-align: center;
        }

         .online-presence ul {
             display: flex;
             flex-wrap: wrap;
             gap: 20px;
             margin-top: 15px;
         }
          .online-presence ul li a {
              display: flex;
              align-items: center;
              font-weight: 500;
          }
          .online-presence ul li i.fab, .online-presence ul li i.fas {
             font-size: 1.2em;
          }
         .wechat-hover-trigger {
             position: relative;
             cursor: default;
             display: flex;
             align-items: center;
             font-weight: 500;
         }
         .wechat-hover-trigger span {
             margin-left: 5px;
             color: var(--text-color);
         }

         .wechat-tooltip {
             visibility: hidden;
             opacity: 0;
             position: absolute;
             bottom: 100%;
             left: 50%;
             transform: translateX(-50%);
             margin-bottom: 10px;
             background-color: white;
             color: var(--dark-grey);
             padding: 15px;
             border-radius: 6px;
             box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
             width: 180px;
             text-align: center;
             z-index: 101;
             transition: opacity 0.3s ease, visibility 0s linear 0.3s;
         }
         .wechat-tooltip img {
             max-width: 100%;
             height: auto;
             display: block;
             margin-bottom: 10px;
         }
         .wechat-tooltip span {
            font-size: 0.9em;
            display: block;
            margin: 0;
            color: var(--dark-grey);
         }

         .wechat-hover-trigger:hover .wechat-tooltip {
             visibility: visible;
             opacity: 1;
             transition: opacity 0.3s ease;
         }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.6);
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: #fff;
            padding: 30px;
            border-radius: 8px;
            text-align: center;
            position: relative;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            max-width: 300px;
            width: 80%;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s ease;
        }

        .modal-close:hover,
        .modal-close:focus {
            color: var(--dark-grey);
        }

        #wechat-qr-image-modal {
            max-width: 100%;
            height: auto;
            display: block;
            margin-top: 15px;
        }
         #wechat-modal .hint {
             font-size: 0.85em;
             color: #777;
             margin-top: 5px;
         }


        .sidebar-info.basic-info {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            width: 100%;
            flex-shrink: 0;
        }
        .sidebar-info.basic-info li i {
            color: var(--secondary-color);
        }

        .sidebar-collapsible-container {
            width: 100%;
            margin-bottom: auto;
             flex-grow: 1;
             overflow-y: auto;
             overflow-x: hidden;
             padding-right: 10px;
        }
         .sidebar-collapsible-container::-webkit-scrollbar {
             width: 8px;
         }
         .sidebar-collapsible-container::-webkit-scrollbar-track {
             background: rgba(255, 255, 255, 0.05);
             border-radius: 10px;
         }
         .sidebar-collapsible-container::-webkit-scrollbar-thumb {
             background: rgba(255, 255, 255, 0.15);
             border-radius: 10px;
         }
          .sidebar-collapsible-container::-webkit-scrollbar-thumb:hover {
             background: rgba(255, 255, 255, 0.25);
         }


        .collapsible-trigger {
            font-size: 1.1em;
            color: var(--light-grey);
            font-weight: 500;
            margin: 0;
            padding: 12px 0;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: color 0.3s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            width: 100%;
        }
        .sidebar-collapsible-container .collapsible-trigger:last-of-type {
             border-bottom: none;
        }

        .collapsible-trigger:hover {
            color: var(--secondary-color);
        }

        .collapsible-trigger i.fas {
            margin-right: 10px;
            font-size: 0.9em;
            transition: transform 0.3s ease;
            color: var(--secondary-color);
            width: 15px;
            text-align: center;
            transform: rotate(0deg);
        }

        .collapsible-content {
            display: none;
            padding-left: 25px;
            overflow: hidden;
            padding-top: 10px;
            padding-bottom: 5px;
        }

        .collapsible-trigger.active i.fas {
            transform: rotate(90deg);
        }

        .collapsible-content .sidebar-info ul {
             margin-top: 0;
             margin-bottom: 10px;
        }

        .collapsible-content .sidebar-info li a,
        .collapsible-content .sidebar-info li span {
            color: #bdc3c7;
            display: inline-block;
            width: calc(100% - 32px);
        }
        .collapsible-content .sidebar-info li a:hover,
         .collapsible-content .sidebar-info li span:hover {
            color: var(--secondary-color);
        }

        .collapsible-content .sidebar-info {
            margin: 0;
        }

        .sidebar-settings-button {
             width: 100%;
             padding: 15px 0;
             margin-top: 20px;
             background-color: rgba(255, 255, 255, 0.05);
             color: var(--light-grey);
             border: none;
             border-radius: 5px;
             font-size: 1em;
             font-weight: 500;
             text-align: center;
             cursor: pointer;
             transition: background-color 0.3s ease, color 0.3s ease;
             flex-shrink: 0;
         }
         .sidebar-settings-button i {
             margin-right: 8px;
         }
         .sidebar-settings-button:hover {
             background-color: rgba(80, 227, 194, 0.2);
             color: var(--secondary-color);
         }

        #welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9998;
            display: block;
            opacity: 1;
            transition: opacity 0.5s ease-out;
        }

        #fireworks-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 9999;
        }

        #welcome-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 2.5em;
            font-weight: bold;
            text-align: center;
            padding: 20px 30px;
            background-color: rgba(0, 0, 0, 0.6);
            border-radius: 10px;
            z-index: 10000;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
        }

        /* Settings Page Specific Styles */
        #settings-page {
            padding: 0;
        }

         #settings-page .content-wrapper {
             max-width: 1000px;
             padding: 0 20px;
             margin-top: 0;
         }

        #settings-page .header {
            /* Fixed Header Styles */
            position: fixed;
            top: 0;
            left: var(--sidebar-width); /* Position it next to the sidebar */
            width: calc(100% - var(--sidebar-width)); /* Span remaining width */
            background-color: var(--card-bg); /* Match content background */
            z-index: 200; /* Ensure it's above scrolling content */
            box-shadow: 0 2px 10px rgba(0,0,0,0.08); /* Add shadow for separation */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px; /* Adjust padding to fit fixed height */
            border-bottom: 1px solid var(--light-grey); /* Keep the border */
            /* Removed margin-bottom and margin-top from here */
        }

        #settings-page .header h1 {
            color: var(--dark-grey);
            font-size: 1.8em;
            margin-bottom: 0;
        }

        #settings-page .header h1 i {
            color: var(--secondary-color);
            margin-right: 10px;
        }

        /* Changed from back-button to save-button style for header */
        #settings-page .header .save-button {
            background-color: var(--secondary-color);
            color: var(--dark-grey);
            border: none;
            padding: 8px 15px; /* Smaller padding than bottom save button */
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9em; /* Smaller font size */
            font-weight: 500;
            transition: background-color 0.3s;
            display: flex;
            align-items: center;
        }
         #settings-page .header .save-button i {
             margin-right: 5px;
         }
         #settings-page .header .save-button:hover {
             background-color: #3dd1b0;
         }


        /* Add padding to the form to prevent content from being under the fixed header */
        #settings-page form {
             padding-top: 80px; /* Adjust this value based on actual header height */
        }


        #settings-page .settings-section {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            padding: 25px;
            margin-bottom: 30px;
             border-left: none;
        }

        #settings-page .settings-section h2 {
            color: var(--dark-grey);
            font-size: 1.4em;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
            display: inline-block;
        }

        #settings-page .settings-section h2 i {
            color: var(--secondary-color);
            margin-right: 8px;
        }

        #settings-page .form-group {
            margin-bottom: 20px;
        }

        #settings-page .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-grey);
        }

        #settings-page .form-group input[type="text"],
        #settings-page .form-group input[type="email"],
        #settings-page .form-group input[type="tel"],
        #settings-page .form-group textarea,
        #settings-page .form-group select {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--light-grey);
            border-radius: 5px;
            font-family: inherit;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        #settings-page .form-group input[type="text"]:focus,
        #settings-page .form-group input[type="email"]:focus,
        #settings-page .form-group input[type="tel"]:focus,
        #settings-page .form-group textarea:focus,
        #settings-page .form-group select:focus {
            border-color: var(--secondary-color);
            outline: none;
        }

        #settings-page .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        #settings-page .form-group .hint {
            font-size: 0.85em;
            color: #777;
            margin-top: 5px;
        }

        #settings-page .form-group .error {
            color: var(--error-color);
            font-size: 0.85em;
            margin-top: 5px;
        }

        .avatar-upload {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .avatar-preview {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            overflow: hidden;
            margin-right: 20px;
            border: 3px solid var(--secondary-color);
            background-color: var(--light-grey);
            display: flex;
             align-items: center;
             justify-content: center;
             color: #777;
             font-size: 0.9em;
             text-align: center;
             flex-shrink: 0;
        }

        .avatar-preview img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .avatar-controls {
            flex-grow: 1;
        }

        .file-input-wrapper {
            position: relative;
            overflow: hidden;
            display: inline-block;
            margin-bottom: 10px;
        }

        .file-input-wrapper input[type="file"] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            cursor: pointer;
            width: 100%;
            height: 100%;
        }

        .file-input-button {
            background-color: var(--primary-color);
            color: white;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: inline-block;
            font-size: 0.9em;
             transition: background-color 0.3s;
        }

        .file-input-button:hover {
            background-color: #3a7bc8;
        }

        .dynamic-list {
            margin-bottom: 20px;
        }

        .dynamic-item {
            background-color: var(--background-color);
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            position: relative;
             border-left: 3px solid var(--primary-color);
        }

         .dynamic-item h4 {
              margin-top: 0;
              margin-bottom: 15px;
              color: var(--dark-grey);
              font-size: 1.1em;
         }

        .dynamic-item .remove-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--error-color);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.8em;
             transition: background-color 0.3s;
             z-index: 1;
        }
         .dynamic-item .remove-btn:hover {
             background-color: #c0392b;
         }
         .dynamic-item .form-group {
             margin-bottom: 15px;
         }
         .dynamic-item .form-group:last-child {
             margin-bottom: 0;
         }


        .add-item-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            display: flex;
            align-items: center;
            font-size: 0.9em;
            transition: background-color 0.3s;
        }

        .add-item-btn i {
            margin-right: 5px;
        }

        .add-item-btn:hover {
            background-color: #27ae60;
        }

        /* Removed the save-section style */


        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 500;
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
        }

        .notification.success {
            background-color: var(--success-color);
        }

        .notification.error {
            background-color: var(--error-color);
        }
         .notification.info {
             background-color: var(--primary-color);
         }


        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 10px;
        }

        .markdown-section {
            display: none;
        }

        .skill-category-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
             flex-wrap: wrap;
             gap: 10px;
        }

        .skill-category-header input[type="text"].skill-category-name {
             flex-grow: 1;
             min-width: 150px;
             margin-right: 10px;
             padding: 5px 8px;
             border: 1px solid var(--light-grey);
             border-radius: 4px;
        }
         .skill-category-header input[type="text"].skill-category-name:focus {
             border-color: var(--primary-color);
         }


        .skill-category-controls {
            display: flex;
            gap: 5px;
             flex-shrink: 0;
        }

        .skill-category-controls button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            color: var(--dark-grey);
            transition: color 0.3s;
            padding: 5px;
        }

        .skill-category-controls button:hover {
            color: var(--primary-color);
        }

        .skill-category-controls .remove-category {
            color: var(--error-color);
        }

        .add-category-btn {
            margin-top: 10px;
        }

        @media (max-width: 768px) {
            body {
                flex-direction: column;
                padding-top: 0;
            }
            .sidebar {
                width: 100%;
                position: static;
                height: auto;
                padding: 20px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.1);
                z-index: 1;
            }
             .profile-pic-placeholder {
                 width: 120px;
                 height: 120px;
             }
             .sidebar h1 {
                 font-size: 1.6em;
             }
              .sidebar-collapsible-container {
                 margin-top: 15px;
                 padding-top: 10px;
                 margin-bottom: 0;
                  flex-grow: 0;
                  padding-right: 0;
                   overflow-y: visible;
             }
              .sidebar-collapsible-container::-webkit-scrollbar {
                  display: none;
              }
             .collapsible-trigger {
                 padding: 8px 0;
             }
             .sidebar-settings-button {
                 margin-top: 15px;
                 padding: 12px 0;
             }

            .main-content {
                margin-left: 0;
                padding: 20px 15px;
                min-height: auto;
            }
             #settings-page .content-wrapper {
                padding: 0;
             }
             #settings-page .header {
                /* Mobile Fixed Header Styles */
                position: fixed; /* Keep fixed */
                top: 0;
                left: 0; /* Span full width */
                width: 100%;
                flex-direction: column;
                 align-items: flex-start;
                 margin-top: 0;
                 padding: 10px 15px; /* Adjust padding for mobile */
                 border-bottom: 1px solid var(--light-grey);
                 box-shadow: 0 2px 5px rgba(0,0,0,0.1);
             }
              #settings-page .header h1 {
                 margin-bottom: 10px; /* Less margin in mobile */
                 font-size: 1.6em;
              }
              #settings-page .header .save-button {
                 width: auto; /* Auto width */
                 margin-top: 5px; /* Space below title */
              }


             /* Adjust padding for the form content in mobile */
             #settings-page form {
                  padding-top: 100px; /* Increase padding for mobile header height */
             }


             #settings-page .settings-section {
                 padding: 15px;
                 margin-bottom: 25px;
             }
             #settings-page .avatar-upload {
                 flex-direction: column;
                 align-items: flex-start;
             }
             .avatar-preview {
                 margin-bottom: 15px;
                 margin-right: 0;
             }
             .skill-category-header {
                flex-direction: column;
                 align-items: flex-start;
                 gap: 5px;
             }
             .skill-category-header input[type="text"].skill-category-name {
                 margin-right: 0;
                 width: 100%;
             }

             h2 {
                 font-size: 1.4em;
             }
             h3 {
                 font-size: 1.2em;
             }
             .skills-grid {
                 grid-template-columns: 1fr;
             }
             .online-presence ul {
                 flex-direction: column;
                 gap: 10px;
             }
             .online-presence ul li {
                 margin-bottom: 8px;
             }
             .main-content > div {
                 padding: 20px 15px;
             }
             #settings-page.page-content {
                 padding: 0;
             }

             .home-tooltip {
                bottom: 120%;
             }
             #welcome-message {
                font-size: 1.8em;
                padding: 15px 20px;
            }
        }

        @media (max-width: 480px) {
            #welcome-message {
                font-size: 1.4em;
                 padding: 10px 15px;
            }
             #settings-page .header h1 {
                 font-size: 1.4em;
             }
        }
    </style>
</head>
<body>

    <div id="welcome-overlay">
        <div id="fireworks-container"></div>
        <div id="welcome-message"></div>
    </div>

    <aside class="sidebar">
        <div class="profile-pic-placeholder">
             <img id="sidebar-avatar" src="图片/头像/20191001125343_shtxh.jpg" alt="姜同学头像">
        </div>
        <h1 id="profile-home-link">
            <span id="sidebar-name">姜同学</span>
            <span class="home-tooltip" id="home-tooltip">点击这里返回主页</span>
        </h1>
        <p class="job-title-sidebar" id="sidebar-job-title">
            游戏系统策划 / 游戏关卡策划 / 技术策划 /前端开发/ Java开发 / 全栈开发/IT驻场维护
        </p>

        <nav class="sidebar-info basic-info">
             <ul>
                <li><i class="fas fa-user"></i><span><strong>年龄:</strong> <span class="sidebar-age"></span></span></li>
                <li><i class="fas fa-graduation-cap"></i><span><strong>学历:</strong> <span class="sidebar-education"></span></span></li>
                <li><i class="fas fa-map-marker-alt"></i><span><strong>坐标:</strong> <span class="sidebar-location"></span></span></li>
                <li><i class="fas fa-briefcase"></i><span><strong>状态:</strong> <span class="sidebar-status"></span></span></li>
            </ul>
        </nav>

        <div class="sidebar-collapsible-container">

            <h3 class="collapsible-trigger" data-target="contact-info-content">
                <i class="fas fa-chevron-right"></i> 联系我
            </h3>
            <div class="collapsible-content" id="contact-info-content">
                <nav class="sidebar-info">
                     <ul id="sidebar-contact-list">
                        <!-- Contact list items will be dynamically populated -->
                        <!-- Keeping default HTML here as a fallback, but will be replaced by JS -->
                        <li><i class="fas fa-phone"></i><a href="tel:15526312845"><strong>电话:</strong>15526312845</a></li>
                        <li><i class="fas fa-envelope"></i><a href="mailto:ucxx66@163.com"><strong>邮箱:</strong>ucxx66@163.com</a></li>
                        <li id="wechat-trigger-sidebar" class="sidebar-wechat-trigger"><i class="fab fa-weixin"></i><span><strong>微信:</strong> G16689683054 (查看)</span></li>
                        <li><i class="fab fa-github"></i><a href="https://github.com/MisZang/MisZang.github.io/tree/main" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                    </ul>
                </nav>
            </div>

            <h3 class="collapsible-trigger" data-target="works-content">
                <i class="fas fa-chevron-right"></i> 个人作品
            </h3>
            <div class="collapsible-content" id="works-content">
                <nav class="sidebar-info">
                     <ul>
                        <li><i class="fas fa-book"></i><a href="javascript:void(0);" data-target-page="novels-page">我的小说</a></li>
                        <li><i class="fas fa-file-alt"></i><a href="javascript:void(0);" data-target-page="articles-page">我的文章</a></li>
                        <li><i class="fas fa-code-branch"></i><a href="javascript:void(0);" data-target-page="projects-page-content">我的项目</a></li>
                    </ul>
                </nav>
            </div>

        </div>

        <button class="sidebar-settings-button" id="settings-trigger">
            <i class="fas fa-cog"></i> 设置
        </button>

    </aside>

    <main class="main-content">
        <!-- Resume Page -->
        <div class="content-wrapper" id="resume-page">

            <section class="section about">
                 <h2><i class="fas fa-user-circle"></i>关于我</h2>
                 <div id="main-about-me">
                    <!-- Content will be dynamically populated -->
                 </div>
            </section>

            <section class="section skills">
                 <h2><i class="fas fa-cogs"></i>专业技能</h2>
                 <div class="skills-grid" id="main-skills-grid">
                     <!-- Skills will be dynamically populated -->
                 </div>
            </section>

            <section class="section experience" id="main-experience-section">
                 <h2><i class="fas fa-briefcase"></i>项目与实践经历</h2>
                 <!-- Projects will be dynamically populated -->
            </section>

            <section class="section education" id="main-education-section">
                 <h2><i class="fas fa-university"></i>教育背景</h2>
                 <!-- Education will be dynamically populated -->
            </section>

            <section class="section certifications" id="main-certs-section">
                <h2><i class="fas fa-certificate"></i>资格证书</h2>
                <ul id="main-certs-list">
                    <!-- Certificates will be dynamically populated -->
                </ul>
            </section>

             <section class="section online-presence" id="main-online-presence-section">
                 <h2><i class="fas fa-share-alt"></i>找到我</h2>
                 <p>期待与您进一步交流！您可以通过以下方式联系我或了解更多：</p>
                <ul id="main-contact-list">
                    <!-- Contact list items will be dynamically populated -->
                </ul>
            </section>
             <!-- Markdown content display section (hidden by default) -->
             <section class="section" id="main-markdown-display" style="display: none;">
                  <h2><i class="fas fa-file-alt"></i>自定义内容</h2>
                  <!-- Markdown HTML content will be loaded here -->
             </section>

        </div>

        <!-- Novels Page -->
        <div id="novels-page" class="page-content" style="display: none;">
            <div class="content-wrapper">
                <section class="section">
                     <h2><i class="fas fa-book"></i>我的小说</h2>
                     <p>这里是我的小说内容区域。目前是空白页面，待填充内容。</p>
                </section>
            </div>
        </div>

        <!-- Articles Page -->
        <div id="articles-page" class="page-content" style="display: none;">
             <div class="content-wrapper">
                 <section class="section">
                     <h2><i class="fas fa-file-alt"></i>我的文章</h2>
                     <p>这里是我的文章内容区域。目前是空白页面，待填充内容。</p>
                 </section>
            </div>
        </div>

        <!-- Projects Summary Page -->
        <div id="projects-page-content" class="page-content" style="display: none;">
             <div class="content-wrapper">
                 <section class="section">
                     <h2><i class="fas fa-code-branch"></i>我的项目汇总</h2>
                     <p>这里是我的项目汇总页面。目前是空白页面，待填充内容。</p>
                     <p>您可以在这里更详细地展示您的所有项目，或者提供不同项目的链接。</p>
                      <!-- Project summaries will be dynamically populated here based on settings.experience -->
                 </section>
            </div>
        </div>

        <!-- Settings Page -->
        <div id="settings-page" class="page-content" style="display: none;">
            <div class="content-wrapper">
                <div class="header">
                    <h1><i class="fas fa-cog"></i>个人主页设置</h1>
                    <button type="button" class="save-button" id="settings-save-button-header">
                        <i class="fas fa-save"></i> 保存设置
                    </button>
                </div>

                <form id="settings-form">
                    <!-- Added padding-top to the form content -->
                    <div class="settings-section">
                        <h2><i class="fas fa-user"></i>基本信息</h2>

                        <div class="avatar-upload">
                            <div class="avatar-preview" id="avatar-preview-container">
                                 <span>头像预览</span>
                            </div>
                            <div class="avatar-controls">
                                <div class="form-group file-input-wrapper">
                                    <div class="file-input-button">
                                        <i class="fas fa-upload"></i> 上传新头像
                                    </div>
                                    <input type="file" id="avatar-upload-input" accept="image/*">
                                </div>
                                <div class="hint">推荐使用正方形图片，最佳尺寸为 300x300 像素</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="name-input">姓名</label>
                            <input type="text" id="name-input" placeholder="请输入您的姓名">
                        </div>

                        <div class="form-group">
                            <label for="job-title-input">期望职位</label>
                            <input type="text" id="job-title-input" placeholder="多个职位请用 / 分隔">
                            <div class="hint">多个职位请用 / 分隔，例如：前端开发 / UI设计师</div>
                        </div>
                    </div>

                    <!-- 个人信息设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-id-card"></i>个人信息</h2>

                        <div class="form-group">
                            <label for="age-input">年龄</label>
                            <input type="text" id="age-input" placeholder="请输入您的年龄">
                        </div>

                        <div class="form-group">
                            <label for="education-level-input">学历</label>
                            <input type="text" id="education-level-input" placeholder="请输入您的最高学历">
                        </div>

                        <div class="form-group">
                            <label for="location-input">所在地</label>
                            <input type="text" id="location-input" placeholder="请输入您的所在地">
                        </div>

                        <div class="form-group">
                            <label for="status-input">求职状态</label>
                            <input type="text" id="status-input" placeholder="例如：在职，看机会 / 离职，求职中">
                        </div>
                    </div>

                    <!-- 联系方式设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-address-book"></i>联系方式</h2>

                        <div class="form-group">
                            <label for="phone-input">电话</label>
                            <input type="tel" id="phone-input" placeholder="请输入您的联系电话">
                        </div>

                        <div class="form-group">
                            <label for="email-input">邮箱</label>
                            <input type="email" id="email-input" placeholder="请输入您的电子邮箱">
                        </div>

                        <div class="form-group">
                            <label for="wechat-input">微信号 (用于侧边栏显示)</label>
                            <input type="text" id="wechat-input" placeholder="请输入您的微信号">
                             <div class="hint">仅影响侧边栏和主页的微信文字显示，不影响二维码。</div>
                        </div>

                        <div class="form-group">
                            <label>微信二维码 (弹窗显示)</label>
                            <div class="avatar-upload">
                                <div class="avatar-preview" id="wechat-qr-preview-container">
                                    <span>二维码预览</span>
                                </div>
                                <div class="avatar-controls">
                                    <div class="form-group file-input-wrapper">
                                        <div class="file-input-button">
                                            <i class="fas fa-upload"></i> 上传二维码
                                        </div>
                                        <input type="file" id="wechat-qr-upload-input" accept="image/*">
                                    </div>
                                    <div class="hint">推荐使用清晰的二维码图片</div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="github-input">GitHub 主页链接</label>
                            <input type="text" id="github-input" placeholder="请输入您的GitHub主页链接">
                        </div>

                        <!-- Other contacts (dynamic) -->
                         <div class="form-group">
                             <label>其他联系方式 (动态添加)</label>
                              <div id="other-contacts-container" class="dynamic-list">
                                   <!-- Dynamic items will be added here -->
                               </div>
                                <button type="button" id="add-other-contact-btn" class="add-item-btn"><i class="fas fa-plus"></i> 添加其他联系方式</button>
                         </div>

                    </div>

                    <!-- 欢迎语设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-comment-dots"></i>欢迎语设置</h2>

                        <div class="form-group">
                            <label for="welcome-message-input">欢迎语</label>
                            <input type="text" id="welcome-message-input" placeholder="请输入访客进入网站时看到的欢迎语">
                            <div class="hint">这段文字将在访客进入您的网站时显示</div>
                        </div>
                    </div>

                    <!-- 关于我设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-user-circle"></i>关于我</h2>

                        <div class="form-group">
                            <label for="about-me-input">自我介绍</label>
                            <textarea id="about-me-input" placeholder="请输入您的自我介绍"></textarea>
                            <div class="hint">支持简单的换行，每个段落请用空行分隔。</div>
                        </div>
                    </div>

                    <!-- 专业技能设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-cogs"></i>专业技能</h2>

                        <div id="skills-container">
                            <!-- Skill categories will be dynamically populated -->
                        </div>
                        <button type="button" id="add-skill-category-btn" class="add-item-btn add-category-btn"><i class="fas fa-plus"></i> 添加技能类别</button>
                    </div>

                    <!-- 项目与实践经历设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-project-diagram"></i>项目与实践经历</h2>
                        <div id="projects-container" class="dynamic-list">
                            <!-- Projects will be dynamically populated -->
                        </div>
                        <button type="button" id="add-project-btn" class="add-item-btn"><i class="fas fa-plus"></i> 添加项目/经历</button>
                    </div>

                    <!-- 教育背景设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-graduation-cap"></i>教育背景</h2>
                        <div id="education-container" class="dynamic-list">
                            <!-- Education entries will be dynamically populated -->
                        </div>
                        <button type="button" id="add-education-btn" class="add-item-btn"><i class="fas fa-plus"></i> 添加教育背景</button>
                    </div>

                    <!-- 资格证书设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-certificate"></i>资格证书</h2>
                        <div id="certificates-container" class="dynamic-list">
                             <!-- Certificate entries will be dynamically populated -->
                        </div>
                        <button type="button" id="add-certificate-btn" class="add-item-btn"><i class="fas fa-plus"></i> 添加证书</button>
                    </div>

                    <!-- 高级设置 -->
                    <div class="settings-section">
                        <h2><i class="fas fa-tools"></i>高级设置</h2>

                        <div class="form-group checkbox-group">
                            <input type="checkbox" id="use-markdown-checkbox">
                            <label for="use-markdown-checkbox">不使用模板，仅渲染 Markdown 内容</label>
                        </div>

                        <div class="form-group markdown-section" id="markdown-editor-section">
                            <label for="markdown-input">Markdown 内容</label>
                            <textarea id="markdown-input" placeholder="在此处输入 Markdown 格式的个人主页内容..."></textarea>
                            <div class="hint">启用此选项后，主页将只显示下方您输入的 Markdown 内容。所有其他设置将被忽略。（功能待实现）</div>
                        </div>

                        <div class="form-group">
                            <button type="button" id="resume-parse-btn" class="placeholder-btn"><i class="fas fa-file-upload"></i> 简历解析 (暂未开放)</button>
                            <div class="hint">未来将支持上传简历文件自动填充信息。</div>
                        </div>

                        <div class="form-group">
                            <button type="button" id="custom-css-btn" class="placeholder-btn"><i class="fas fa-paint-brush"></i> 自定义 CSS (暂未开放)</button>
                            <div class="hint">未来将支持添加自定义 CSS 样式。</div>
                        </div>
                    </div>

                    <!-- Removed the save-section block -->
                </form>
            </div>
        </div>
        <!-- End Settings Page -->

    </main>

    <div id="wechat-modal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <p style="font-weight: 500; margin-bottom: 15px; color: var(--secondary-color);">扫描微信二维码</p>
            <img src="图片/二维码/Screenshot_2025_0427_015845.png" alt="微信二维码" id="wechat-qr-image-modal">
             <div class="hint" style="margin-top: 10px;">请勿将本页面二维码直接分享，此二维码可能随更新而变化。</div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script src="https://cdn.jsdelivr.net/npm/fireworks-js@latest/dist/fireworks.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {

             // --- Fireworks Initialization ---
            const overlay = document.getElementById('welcome-overlay');
            const fireworksContainer = document.getElementById('fireworks-container');
            const welcomeMessageDisplay = document.getElementById('welcome-message');

            // To ensure the welcome message is set *before* the overlay potentially shows,
            // we will move the fireworks/overlay logic slightly to run after initial settings load and display update.
            // For now, let's leave the initializer here, but the actual showing depends on updateResumeDisplay setting the text.
            let fireworks = null;
            if (fireworksContainer && typeof Fireworks !== 'undefined') {
                 fireworks = new Fireworks(fireworksContainer, {
                     rocketsPoint: { min: 40, max: 60 },
                     hue: { min: 0, max: 360 },
                     delay: { min: 30, max: 60 },
                     speed: 2,
                     acceleration: 1.03,
                     friction: 0.96,
                     gravity: 1.2,
                     particles: 70,
                     flickering: 50,
                     intensity: 20,
                     explosion: 6,
                     brightness: { min: 50, max: 80 },
                     decay: { min: 0.015, max: 0.03 }
                 });
                 // fireworks.start() will be called after updateResumeDisplay
            } else {
                console.warn("无法初始化欢迎特效：元素或 Fireworks 库未找到。");
                 // Ensure overlay is hidden if fireworks not initialized
                 if(overlay) overlay.style.display = 'none';
            }


            // --- WeChat Modal ---
            const wechatModal = document.getElementById("wechat-modal");
            const modalClose = wechatModal?.querySelector(".modal-close");
             const wechatQrImageModal = document.getElementById('wechat-qr-image-modal');


            function openModal() {
                if (wechatModal) {
                    wechatModal.style.display = "flex";
                }
            }

            function closeModal() {
                 if (wechatModal) {
                    wechatModal.style.display = "none";
                 }
            }

            document.body.addEventListener('click', (event) => {
                const trigger = event.target.closest('.sidebar-wechat-trigger');
                if (trigger && typeof openModal === 'function') {
                     event.preventDefault();
                     openModal();
                }
            });

            if (modalClose) {
                modalClose.addEventListener("click", closeModal);
            }

            window.addEventListener("click", (event) => {
                if (event.target === wechatModal) {
                    closeModal();
                }
            });

            window.addEventListener("keydown", (event) => {
                 if (event.key === "Escape" && wechatModal && wechatModal.style.display === "flex") {
                     closeModal();
                 }
            });


            // --- Sidebar Collapsible Logic ---
            const triggers = document.querySelectorAll('.collapsible-trigger');
            triggers.forEach(clickedTrigger => {
                clickedTrigger.addEventListener('click', () => {
                    const targetId = clickedTrigger.getAttribute('data-target');
                    const clickedContent = document.getElementById(targetId);
                    const isCurrentlyActive = clickedTrigger.classList.contains('active');
                    const icon = clickedTrigger.querySelector('i.fas');

                    if (isCurrentlyActive) {
                        clickedTrigger.classList.remove('active');
                        if (clickedContent) {
                            clickedContent.style.display = 'none';
                        }
                        if (icon) icon.style.transform = 'rotate(0deg)';
                    } else {
                        triggers.forEach(otherTrigger => {
                            if (otherTrigger !== clickedTrigger && otherTrigger.classList.contains('active')) {
                                otherTrigger.classList.remove('active');
                                const otherContentId = otherTrigger.getAttribute('data-target');
                                const otherContent = document.getElementById(otherContentId);
                                 const otherIcon = otherTrigger.querySelector('i.fas');
                                if (otherContent) {
                                    otherContent.style.display = 'none';
                                }
                                 if (otherIcon) otherIcon.style.transform = 'rotate(0deg)';
                            }
                        });

                        clickedTrigger.classList.add('active');
                        if (clickedContent) {
                            clickedContent.style.display = 'block';
                        }
                        if (icon) icon.style.transform = 'rotate(90deg)';
                    }
                });
            });


            // --- Page Switching Logic ---
            const mainContentArea = document.querySelector('.main-content');
            const sidebarWorkLinks = document.querySelectorAll('#works-content .sidebar-info a[data-target-page]');
            const profileHomeLink = document.getElementById('profile-home-link');
            const settingsTrigger = document.getElementById('settings-trigger');
            const settingsSaveButtonHeader = document.getElementById('settings-save-button-header'); // Header save button
            const allPages = document.querySelectorAll('.main-content > div[id]');
            const homeTooltip = document.getElementById('home-tooltip');
            let tooltipTimeoutId = null;


            function showPage(pageIdToShow) {
                let pageFound = false;

                if (tooltipTimeoutId) {
                    clearTimeout(tooltipTimeoutId);
                    tooltipTimeoutId = null;
                }
                if (homeTooltip) {
                    homeTooltip.classList.remove('show');
                }

                allPages.forEach(page => {
                    if (page.id === pageIdToShow) {
                        page.style.display = 'block';
                        pageFound = true;
                         if (page.id === 'settings-page') {
                             populateSettingsForm(currentSettings);
                         }
                    } else {
                        page.style.display = 'none';
                    }
                });

                if (!pageFound) {
                    console.warn(`Page with ID "${pageIdToShow}" not found. Showing resume page.`);
                     const resumePage = document.getElementById('resume-page');
                     if (resumePage) resumePage.style.display = 'block';
                } else {
                     if (pageIdToShow !== 'resume-page' && homeTooltip) {
                         homeTooltip.classList.add('show');
                         tooltipTimeoutId = setTimeout(() => {
                             homeTooltip.classList.remove('show');
                             tooltipTimeoutId = null;
                         }, 3000);
                     }
                }

                 if (mainContentArea) {
                     const scrollTarget = window.innerWidth <= 768 ? 0 : mainContentArea.offsetTop - 20;
                     window.scrollTo({ top: scrollTarget, behavior: 'smooth' });
                 } else {
                      window.scrollTo({ top: 0, behavior: 'smooth' });
                 }
            }

            // Navigation Links
            sidebarWorkLinks.forEach(link => {
                link.addEventListener('click', function(event) {
                    event.preventDefault();
                    const targetPageId = this.getAttribute('data-target-page');
                    if (targetPageId) {
                        showPage(targetPageId);
                    }
                });
            });

            if (profileHomeLink) {
                profileHomeLink.addEventListener('click', function(event) {
                     event.preventDefault();
                     if (tooltipTimeoutId) {
                         clearTimeout(tooltipTimeoutId);
                         tooltipTimeoutId = null;
                     }
                     if (homeTooltip) {
                         homeTooltip.classList.remove('show');
                     }
                    showPage('resume-page');
                });
            }

            if (settingsTrigger) {
                settingsTrigger.addEventListener('click', function(event) {
                    event.preventDefault();
                    showPage('settings-page');
                });
            }

            // --- Settings Data & Logic ---

            const SETTINGS_STORAGE_KEY = 'resumeSettings';
            let currentSettings = {};

            // Selectors for Settings Page Elements
            const settingsForm = document.getElementById('settings-form');
            const avatarUploadInput = document.getElementById('avatar-upload-input');
            const avatarPreviewContainer = document.getElementById('avatar-preview-container');
            const nameInput = document.getElementById('name-input');
            const jobTitleInput = document.getElementById('job-title-input');
            const ageInput = document.getElementById('age-input');
            const educationLevelInput = document.getElementById('education-level-input');
            const locationInput = document.getElementById('location-input');
            const statusInput = document.getElementById('status-input');
            const phoneInput = document.getElementById('phone-input');
            const emailInput = document.getElementById('email-input');
            const wechatInput = document.getElementById('wechat-input');
            const wechatQrUploadInput = document.getElementById('wechat-qr-upload-input');
            const wechatQrPreviewContainer = document.getElementById('wechat-qr-preview-container');
            const githubInput = document.getElementById('github-input');
            const otherContactsContainer = document.getElementById('other-contacts-container');
            const addOtherContactBtn = document.getElementById('add-other-contact-btn');
            const welcomeMessageInput = document.getElementById('welcome-message-input');
            const aboutMeInput = document.getElementById('about-me-input');
            const skillsContainerEdit = document.getElementById('skills-container');
            const addSkillCategoryBtn = document.getElementById('add-skill-category-btn');
            const projectsContainerEdit = document.getElementById('projects-container');
            const addProjectBtn = document.getElementById('add-project-btn');
            const educationContainerEdit = document.getElementById('education-container');
            const addEducationBtn = document.getElementById('add-education-btn');
            const certificatesContainerEdit = document.getElementById('certificates-container');
            const addCertificateBtn = document.getElementById('add-certificate-btn');
            const useMarkdownCheckbox = document.getElementById('use-markdown-checkbox');
            const markdownInput = document.getElementById('markdown-input');
            const markdownEditorSection = document.getElementById('markdown-editor-section');
            const resumeParseBtn = document.getElementById('resume-parse-btn');
            const customCssBtn = document.getElementById('custom-css-btn');
            // Removed saveSettingsBtn variable

            const notificationElement = document.getElementById('notification');

            // Selectors for Main Resume Display Elements
            const sidebarAvatar = document.querySelector('.sidebar .profile-pic-placeholder img');
            const sidebarNameSpan = document.querySelector('#profile-home-link span');
            const sidebarJobTitle = document.querySelector('.job-title-sidebar');
            // Corrected selectors to point to the inner spans
            const sidebarAgeSpan = document.querySelector('.sidebar-info.basic-info .sidebar-age');
            const sidebarEducationSpan = document.querySelector('.sidebar-info.basic-info .sidebar-education');
            const sidebarLocationSpan = document.querySelector('.sidebar-info.basic-info .sidebar-location');
            const sidebarStatusSpan = document.querySelector('.sidebar-info.basic-info .sidebar-status');
            const sidebarContactList = document.getElementById('sidebar-contact-list');

            const mainAboutMeDiv = document.getElementById('main-about-me');
            const mainSkillsGrid = document.getElementById('main-skills-grid');
            const mainExperienceSection = document.getElementById('main-experience-section');
            const mainEducationSection = document.getElementById('main-education-section');
            const mainCertsList = document.getElementById('main-certs-list');
            const mainContactList = document.getElementById('main-contact-list');
             const mainMarkdownDisplaySection = document.getElementById('main-markdown-display');


            // --- Default Settings Structure ---
            const defaultSettings = {
                profilePic: '图片/头像/20191001125343_shtxh.jpg',
                name: '姜同学',
                jobTitle: '游戏系统策划 / 游戏关卡策划 / 技术策划 /前端开发/ Java开发 / 全栈开发/IT驻场维护',
                age: '21岁',
                educationLevel: '大专 (软件技术)',
                location: '广东',
                status: '寻找机会中',
                contact: {
                    phone: '15526312845',
                    email: 'ucxx66@163.com',
                    wechat: 'G16689683054',
                    wechatQr: '图片/二维码/Screenshot_2025_0427_015845.png',
                    github: 'https://github.com/MisZang/MisZang.github.io/tree/main',
                    others: []
                },
                welcomeMessage: '我等你好久了，请给我offer',
                aboutMe: `你好！我是一名对游戏设计与软件开发充满热情的应届毕业生。我拥有超过一万小时的多元游戏经验（策略、RPG、MOBA 等），这不仅培养了我对游戏的热爱，更训练了我深度拆解和分析游戏系统的能力，尤其擅长从核心循环、养成梯度、经济模型及玩家心理层面进行研究。

同时，作为软件技术专业的学生，我具备扎实的全栈开发基础，熟练掌握 Java (Spring Boot)、前端技术 (Vue.js, Electron, H5/CSS/JS) 以及 Python 等，并拥有完整的项目开发经验（如独立完成的类微信 IM 应用）。我热衷于用技术验证设计想法，例如使用 UE5 进行关卡原型设计，或利用 Python 进行玩家社群数据分析。

我具备优秀的逻辑思维、问题解决、快速学习和文档撰写能力。无论是进行游戏系统/关卡/技术策划，还是从事前端/后端/全栈开发，或是提供 IT 技术支持，我都渴望能够将我的分析能力、技术实践和持续学习的热情结合起来，为团队创造价值。我目前离校，期待能尽快加入一个专业的团队，在实践中不断成长。`,
                skills: [
                     { id: 1, name: '游戏设计 & 分析', tags: ['游戏系统拆解', '核心玩法分析', '数值体验感知', '用户分层研究', '付费系统分析', '竞品分析', '设计文档撰写', '关卡设计基础'] },
                     { id: 2, name: '开发 & 技术', tags: ['Java (Spring Boot)', 'Vue.js', 'Electron', 'HTML5/CSS3/JavaScript', 'Python', 'MySQL', 'Git', 'UE5 (蓝图基础)', 'Linux 基础'] },
                     { id: 3, name: '其它能力', tags: ['逻辑思维', '问题解决', '快速学习', '文档撰写', '沟通协作', '数据分析基础'] }
                 ],
                experience: [
                    { id: 1, desc: `**独立开发类微信 IM 应用 (2023.09 - 2024.01)**
*   **技术栈:** Java (Spring Boot), Vue.js, Electron, WebSocket, MySQL
*   **职责:** 独立完成需求分析、架构设计、前后端开发、数据库设计及部署。
*   **成果:** 实现用户注册/登录、单聊/群聊、好友管理、消息实时推送、历史消息存储、文件传输等核心功能。熟练掌握了全栈开发流程及相关技术。

**UE5 关卡设计练习 (持续进行)**
*   **工具:** Unreal Engine 5
*   **内容:** 利用 UE5 蓝图和资源市场素材，进行小型关卡原型设计，探索不同玩法机制（如潜行、解谜）的实现，锻炼关卡流程、节奏和视觉引导的设计能力。

**Python 游戏社群数据分析 (个人项目)**
*   **技术:** Python (Pandas, Matplotlib), API 调用
*   **内容:** 尝试获取并分析特定游戏社群（如贴吧、论坛）的玩家讨论数据，提取热点话题、玩家情绪等信息，为理解玩家反馈和社群生态提供数据支持。`},
                ],
                education: [
                    { id: 1, school: '广东工商职业技术大学', major: '软件技术', degree: '大专', time: '2021.09 - 2024.06' }
                ],
                certificates: [
                    { id: 1, name: '全国计算机等级考试二级 (MS Office 高级应用)' },
                    { id: 2, name: '英语 A 级证书' },
                    { id: 3, name: '全国计算机等级一级' },
                    { id: 4, name: '网页制作员 (Web 初级)' },
                    { id: 5, name: '电工资格等级证书4级' },
                    { id: 6, name: '电工高压特种作业操作证（备考中）' }
                ],
                useMarkdown: false,
                markdownContent: ''
            };

            // --- Core Functions ---

            function deepMerge(target, source) {
                for (const key in source) {
                    if (source.hasOwnProperty(key)) {
                        if (typeof source[key] === 'object' && source[key] !== null && key in target && typeof target[key] === 'object' && target[key] !== null) {
                             if (Array.isArray(source[key])) {
                                 target[key] = source[key];
                             } else {
                                deepMerge(target[key], source[key]);
                             }
                        } else {
                            target[key] = source[key];
                        }
                    }
                }
                return target;
            }


            /**
             * Loads settings from localStorage or uses defaults, then updates UI.
             */
            function loadSettings() {
                const storedSettings = localStorage.getItem(SETTINGS_STORAGE_KEY);
                try {
                    const parsedSettings = storedSettings ? JSON.parse(storedSettings) : {};
                    currentSettings = deepMerge(JSON.parse(JSON.stringify(defaultSettings)), parsedSettings);

                     if (!currentSettings.contact) currentSettings.contact = {};
                     if (!currentSettings.contact.others) currentSettings.contact.others = [];
                     if (!currentSettings.skills) currentSettings.skills = [];
                     if (!currentSettings.experience) currentSettings.experience = [];
                     if (!currentSettings.education) currentSettings.education = [];
                     if (!currentSettings.certificates) currentSettings.certificates = [];

                     console.log('Loaded settings:', currentSettings); // Log loaded settings

                } catch (e) {
                    console.error("Error parsing settings from localStorage:", e);
                    currentSettings = JSON.parse(JSON.stringify(defaultSettings));
                }
                updateResumeDisplay(currentSettings);

                // Start fireworks after settings are loaded and welcome message is set
                if(fireworks && overlay && welcomeMessageDisplay && welcomeMessageDisplay.textContent) {
                     fireworks.start();
                     overlay.style.display = 'block'; // Ensure overlay is visible before fading
                     overlay.style.opacity = '1';
                     setTimeout(() => {
                        overlay.style.opacity = '0';
                        setTimeout(() => {
                             if(fireworks && typeof fireworks.stop === 'function') {
                                fireworks.stop();
                             }
                            overlay.style.display = 'none';
                        }, 500);
                    }, 2000); // Duration of the welcome display
                } else if (overlay) {
                     // Hide overlay immediately if no welcome message or fireworks not available
                      overlay.style.display = 'none';
                }
            }

            /**
             * Populates the #settings-page form fields with data.
             */
            function populateSettingsForm(data) {
                if (!settingsForm) return;

                updateAvatarPreview(data.profilePic, avatarPreviewContainer, '头像预览');
                if (nameInput) nameInput.value = data.name || '';
                if (jobTitleInput) jobTitleInput.value = data.jobTitle || '';

                 if (ageInput) ageInput.value = data.age || '';
                 if (educationLevelInput) educationLevelInput.value = data.educationLevel || '';
                 if (locationInput) locationInput.value = data.location || '';
                 if (statusInput) statusInput.value = data.status || '';

                if (phoneInput) phoneInput.value = data.contact?.phone || '';
                if (emailInput) emailInput.value = data.contact?.email || '';
                if (wechatInput) wechatInput.value = data.contact?.wechat || '';
                updateAvatarPreview(data.contact?.wechatQr, wechatQrPreviewContainer, '二维码预览');
                if (githubInput) githubInput.value = data.contact?.github || '';

                if (otherContactsContainer) {
                    otherContactsContainer.innerHTML = '';
                    [...(data.contact?.others || [])].forEach(other => addOtherContactEntry(other, false));
                }

                if (welcomeMessageInput) welcomeMessageInput.value = data.welcomeMessage || '';
                if (aboutMeInput) aboutMeInput.value = data.aboutMe || '';

                 if (skillsContainerEdit) {
                     skillsContainerEdit.innerHTML = '';
                     [...(data.skills || [])].forEach(category => addSkillCategory(category, false));
                 }

                if (projectsContainerEdit) {
                    projectsContainerEdit.innerHTML = '';
                     [...(data.experience || [])].forEach(exp => addExperienceEntry(exp, false));
                }

                if (educationContainerEdit) {
                    educationContainerEdit.innerHTML = '';
                     [...(data.education || [])].forEach(edu => addEducationEntry(edu, false));
                }

                 if (certificatesContainerEdit) {
                     certificatesContainerEdit.innerHTML = '';
                     [...(data.certificates || [])].forEach(cert => addCertEntry(cert, false));
                 }

                if (useMarkdownCheckbox) {
                     useMarkdownCheckbox.checked = data.useMarkdown === true;
                     setTimeout(() => {
                        const event = new Event('change');
                        useMarkdownCheckbox.dispatchEvent(event);
                     }, 0);
                 }
                if (markdownInput) markdownInput.value = data.markdownContent || '';
            }

            /**
             * Updates the main resume display.
             */
            function updateResumeDisplay(data) {
                // Sidebar Updates
                if (sidebarAvatar) sidebarAvatar.src = data.profilePic || defaultSettings.profilePic;
                if (sidebarNameSpan) sidebarNameSpan.textContent = data.name || '';
                if (sidebarJobTitle) sidebarJobTitle.textContent = data.jobTitle || '';

                // FIX: Only update the text content of the inner spans
                if (sidebarAgeSpan) sidebarAgeSpan.textContent = data.age || '';
                if (sidebarEducationSpan) sidebarEducationSpan.textContent = data.educationLevel || '';
                if (sidebarLocationSpan) sidebarLocationSpan.textContent = data.location || '';
                if (sidebarStatusSpan) sidebarStatusSpan.textContent = data.status || '';

                // Sidebar Contact Info
                 const sidebarContactTrigger = document.querySelector('.sidebar .collapsible-trigger[data-target="contact-info-content"]');
                 const sidebarContactContent = document.getElementById('contact-info-content');

                 if (sidebarContactList && sidebarContactTrigger && sidebarContactContent) {
                    const contacts = data.contact || {};
                    const hasEmail = !!contacts.email;
                    const hasPhone = !!contacts.phone;
                    const hasWechat = !!contacts.wechat;
                    const hasGithub = !!contacts.github;
                    const hasOthers = contacts.others && contacts.others.length > 0;

                    sidebarContactList.innerHTML = '';

                    if (hasPhone) sidebarContactList.appendChild(createSidebarContactLi('fas fa-phone', `tel:${contacts.phone}`, `<strong>电话:</strong> ${contacts.phone}`));
                    if (hasEmail) sidebarContactList.appendChild(createSidebarContactLi('fas fa-envelope', `mailto:${contacts.email}`, `<strong>邮箱:</strong> ${contacts.email}`));
                    if (hasWechat) sidebarContactList.appendChild(createSidebarContactLi('fab fa-weixin', 'javascript:void(0);', `<strong>微信:</strong> ${contacts.wechat} (查看)`, null, null, 'wechat-trigger-sidebar'));
                    if (hasGithub) sidebarContactList.appendChild(createSidebarContactLi('fab fa-github', contacts.github, 'GitHub', '_blank', 'noopener noreferrer'));
                    (contacts.others || []).forEach(other => {
                         let href = other.value || 'javascript:void(0);';
                         let text = other.value || '';
                         let target = '_blank';
                         let rel = 'noopener noreferrer';
                          if (!other.value.startsWith('http://') && !other.value.startsWith('https://') && !other.value.startsWith('tel:') && !other.value.startsWith('mailto:') && other.icon !== 'fab fa-weixin') {
                             href = 'javascript:void(0);';
                             target = null;
                             rel = null;
                             text = other.type ? `${other.type}: ${text}` : text;
                          } else if (other.type) {
                               text = other.type;
                          }
                        sidebarContactList.appendChild(createSidebarContactLi(other.icon || 'fas fa-link', href, text, target, rel));
                    });

                     if (sidebarContactList.children.length === 0) {
                          sidebarContactTrigger.style.display = 'none';
                          sidebarContactContent.style.display = 'none';
                     } else {
                          sidebarContactTrigger.style.display = '';
                          if (sidebarContactTrigger.classList.contains('active')) {
                               sidebarContactContent.style.display = 'block';
                           } else {
                                sidebarContactContent.style.display = 'none';
                           }
                     }
                }
                 if (wechatQrImageModal) {
                      wechatQrImageModal.src = data.contact?.wechatQr || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';
                 }

                // Main Content Updates (Resume Page)
                const useMarkdown = data.useMarkdown === true;

                 if (mainAboutMeDiv && mainSkillsGrid && mainExperienceSection && mainEducationSection && mainCertsList && mainContactList && mainMarkdownDisplaySection) {
                    const sectionsToToggle = [
                        mainAboutMeDiv.parentElement,
                        mainSkillsGrid.parentElement,
                        mainExperienceSection,
                        mainEducationSection,
                        mainCertsList.parentElement,
                        mainContactList.parentElement
                    ];

                    sectionsToToggle.forEach(section => {
                        if (section) section.style.display = useMarkdown ? 'none' : '';
                    });

                    if (useMarkdown) {
                        mainMarkdownDisplaySection.style.display = 'block';
                        mainMarkdownDisplaySection.innerHTML = `<h2><i class="fas fa-file-alt"></i>自定义内容</h2>${convertMarkdownToHtml(data.markdownContent || '')}`;
                    } else {
                        mainMarkdownDisplaySection.style.display = 'none';

                        mainAboutMeDiv.innerHTML = wrapInParagraphs(data.aboutMe || '');

                        mainSkillsGrid.innerHTML = '';
                        if (data.skills && data.skills.length > 0) {
                            data.skills.forEach(category => {
                                const categoryDiv = document.createElement('div');
                                categoryDiv.className = 'skill-category';
                                categoryDiv.innerHTML = `<h4>${category.name || '无类别名称'}</h4><div class="tags-list"></div>`;
                                const tagsListDiv = categoryDiv.querySelector('.tags-list');
                                category.tags?.forEach(tagText => {
                                    const tagSpan = document.createElement('span');
                                    tagSpan.className = 'tag';
                                    tagSpan.textContent = tagText;
                                    if (tagText.toLowerCase().includes('java') || tagText.toLowerCase().includes('vue') || tagText.toLowerCase().includes('html') || tagText.toLowerCase().includes('css') || tagText.toLowerCase().includes('javascript') || tagText.toLowerCase().includes('mysql')) tagSpan.classList.add('highlight');
                                    if (tagText.toLowerCase().includes('unreal') || tagText.toLowerCase().includes('unity')) tagSpan.classList.add('engine');
                                    if (tagText.toLowerCase().includes('git') || tagText.toLowerCase().includes('excel') || tagText.toLowerCase().includes('python') || tagText.toLowerCase().includes('vs code')) tagSpan.classList.add('tool');
                                    tagsListDiv.appendChild(tagSpan);
                                });
                                mainSkillsGrid.appendChild(categoryDiv);
                            });
                        } else {
                            mainSkillsGrid.innerHTML = '<p>暂无技能信息。</p>';
                        }

                         mainExperienceSection.innerHTML = `<h2><i class="fas fa-briefcase"></i>项目与实践经历</h2>`;
                         if (data.experience && data.experience.length > 0) {
                            data.experience.forEach((exp, index) => {
                                const htmlDesc = convertMarkdownToHtml(exp.desc || '');
                                const projectDiv = document.createElement('div');
                                projectDiv.className = 'project';
                                projectDiv.innerHTML = htmlDesc;

                                  // Add generic placeholder if no image provided/found
                                   const placeholder = document.createElement('div');
                                   placeholder.className = 'project-image-placeholder';
                                   placeholder.textContent = '项目图片/占位符';
                                   projectDiv.appendChild(placeholder);

                                mainExperienceSection.appendChild(projectDiv);
                                 // Add separator if not the last project
                                 if (index < data.experience.length - 1) {
                                     const separator = document.createElement('div');
                                     separator.style.cssText = 'height: 1px; background-color: #eee; margin: 20px 0;';
                                     mainExperienceSection.appendChild(separator);
                                 }
                            });
                        } else {
                             mainExperienceSection.innerHTML += '<p>暂无项目经历。</p>';
                        }

                         mainEducationSection.innerHTML = `<h2><i class="fas fa-university"></i>教育背景</h2>`;
                         if (data.education && data.education.length > 0) {
                             data.education.forEach((edu, index) => {
                                 const eduBlock = document.createElement('div');
                                  eduBlock.classList.add('education-entry'); // Add class for potential future styling/selection
                                 eduBlock.innerHTML = `
                                     <p><strong>${edu.school || ''}</strong></p>
                                     <p><strong>专业:</strong> ${edu.major || ''}</p>
                                     <p><strong>学历:</strong> ${edu.degree || ''}</p>
                                     <p><strong>时间:</strong> ${edu.time || ''}</p>
                                 `;
                                 mainEducationSection.appendChild(eduBlock);
                                 if (data.education.length > 1 && index < data.education.length - 1) {
                                      const separator = document.createElement('hr');
                                      separator.style.cssText = 'margin: 20px 0; border: 0; border-top: 1px solid #eee;';
                                       mainEducationSection.appendChild(separator);
                                 }
                             });
                         } else {
                             mainEducationSection.innerHTML += '<p>暂无教育背景信息。</p>';
                         }

                         mainCertsList.innerHTML = '';
                         if (data.certificates && data.certificates.length > 0) {
                             data.certificates.forEach(cert => {
                                 const li = document.createElement('li');
                                 li.innerHTML = `<i class="fas fa-award"></i>${cert.name || ''}`;
                                 mainCertsList.appendChild(li);
                             });
                         } else {
                            const li = document.createElement('li');
                            li.textContent = '暂无证书信息。';
                            mainCertsList.appendChild(li);
                         }

                         mainContactList.innerHTML = '';
                         const contacts = data.contact || {};
                         const hasEmail = !!contacts.email;
                         const hasPhone = !!contacts.phone;
                         const hasWechat = !!contacts.wechat;
                         const hasGithub = !!contacts.github;
                         const hasOthers = contacts.others && contacts.others.length > 0;

                         if (hasPhone) mainContactList.appendChild(createMainContactLi('fas fa-phone', `tel:${contacts.phone}`, contacts.phone));
                         if (hasEmail) mainContactList.appendChild(createMainContactLi('fas fa-envelope', `mailto:${contacts.email}`, contacts.email));
                         if (hasWechat) mainContactList.appendChild(createMainContactLi('fab fa-weixin', 'javascript:void(0);', contacts.wechat, null, null, true));
                          if (hasGithub) mainContactList.appendChild(createMainContactLi('fab fa-github', contacts.github, 'GitHub', '_blank', 'noopener noreferrer'));
                         (contacts.others || []).forEach(other => {
                             let href = other.value || 'javascript:void(0);';
                             let text = other.value || '';
                             let target = '_blank';
                             let rel = 'noopener noreferrer';
                              if (!other.value.startsWith('http://') && !other.value.startsWith('https://') && !other.value.startsWith('tel:') && !other.value.startsWith('mailto:') && other.icon !== 'fab fa-weixin') {
                                  href = 'javascript:void(0);';
                                  target = null;
                                  rel = null;
                                  text = other.type ? `${other.type}: ${text}` : text;
                              } else if (other.type) {
                                   text = other.type ? `${other.type}: ${text}` : text;
                              }
                            mainContactList.appendChild(createMainContactLi(other.icon || 'fas fa-link', href, text, target, rel));
                        });

                         if (!hasEmail && !hasPhone && !hasWechat && !hasGithub && !hasOthers) {
                              const li = document.createElement('li');
                              li.textContent = '暂无联系方式。';
                              mainContactList.appendChild(li);
                         }
                    }
                } else {
                    console.error("Main resume display elements not found!");
                }

                 // Update Welcome Message Display (if it exists)
                 if (welcomeMessageDisplay) {
                      welcomeMessageDisplay.textContent = data.welcomeMessage || '';
                 }
            }

             /** Converts simple markdown-like text to HTML */
            function convertMarkdownToHtml(text) {
                if (!text) return '';
                let html = text.trim();

                html = html.replace(/^###\s+(.*)/gm, '<h3>$1</h3>');
                html = html.replace(/^##\s+(.*)/gm, '<h2>$1</h2>');
                html = html.replace(/^#\s+(.*)/gm, '<h1>$1</h1>');

                html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                html = html.replace(/\*(.*?)\*/g, '<em>$1</em>');

                let lines = html.split('\n');
                let inList = false;
                let htmlLines = [];

                lines.forEach(line => {
                    const trimmedLine = line.trim();
                    if (trimmedLine.startsWith('* ')) {
                        if (!inList) {
                            htmlLines.push('<ul>');
                            inList = true;
                        }
                        htmlLines.push(`<li>${trimmedLine.substring(2)}</li>`);
                    } else if (trimmedLine === '') {
                        if (inList) {
                            htmlLines.push('</ul>');
                            inList = false;
                        }
                        htmlLines.push('');
                    } else {
                        if (inList) {
                            htmlLines.push('</ul>');
                            inList = false;
                        }
                        htmlLines.push(line);
                    }
                });

                if (inList) {
                    htmlLines.push('</ul>');
                }

                html = htmlLines.join('\n');

                 html = html.split(/\n\s*\n+/).map(block => {
                     const trimmedBlock = block.trim();
                     if (!trimmedBlock) return '';

                     if (trimmedBlock.startsWith('<h') || trimmedBlock.startsWith('<ul') || trimmedBlock.startsWith('<p') || trimmedBlock.startsWith('<div')) { // Added div check for image placeholders
                          return block;
                     }

                     const htmlBlock = trimmedBlock.replace(/\n/g, '<br>');
                     return `<p>${htmlBlock}</p>`;
                 }).join('');

                 html = html.replace(/<p>\s*<\/p>/g, '');


                return html;
            }


            /**
             * Saves the current settings from the form to localStorage and updates display.
             */
            function saveSettings() {
                 if (!settingsForm) {
                     console.error("Settings form element not found!");
                     showNotification('保存失败：设置表单元素未找到。', 'error');
                     return;
                 }

                 const newSettings = {
                     profilePic: avatarPreviewContainer?.querySelector('img')?.src || null,
                     name: nameInput?.value.trim() || '',
                     jobTitle: jobTitleInput?.value.trim() || '',
                     age: ageInput?.value.trim() || '',
                     educationLevel: educationLevelInput?.value.trim() || '',
                     location: locationInput?.value.trim() || '',
                     status: statusInput?.value.trim() || '',
                     contact: {
                         phone: phoneInput?.value.trim() || '',
                         email: emailInput?.value.trim() || '',
                         wechat: wechatInput?.value.trim() || '',
                         wechatQr: wechatQrPreviewContainer?.querySelector('img')?.src || null,
                         github: githubInput?.value.trim() || '',
                         others: []
                     },
                     welcomeMessage: welcomeMessageInput?.value.trim() || '',
                     aboutMe: aboutMeInput?.value.trim() || '',
                     skills: [],
                     experience: [],
                     education: [],
                     certificates: [],
                     useMarkdown: useMarkdownCheckbox?.checked || false,
                     markdownContent: markdownInput?.value.trim() || ''
                 };

                 skillsContainerEdit?.querySelectorAll('.skill-category').forEach(categoryDiv => {
                     const categoryNameInput = categoryDiv.querySelector('.skill-category-name');
                     const tagsListDiv = categoryDiv.querySelector('.tag-input-container');
                     const tags = [];
                     tagsListDiv?.querySelectorAll('.tag').forEach(tagSpan => {
                         const tagName = tagSpan.cloneNode(true);
                         tagName.querySelector('.remove-tag')?.remove();
                         tags.push(tagName.textContent.trim());
                     });
                     if (categoryNameInput?.value.trim() || tags.length > 0) {
                         newSettings.skills.push({
                             id: categoryDiv.dataset.id || Date.now() + '_skillcat' + Math.random(),
                             name: categoryNameInput?.value.trim() || '',
                             tags: tags
                         });
                     }
                 });

                 projectsContainerEdit?.querySelectorAll('.dynamic-item').forEach(entry => {
                     const descTextarea = entry.querySelector('textarea');
                     if (descTextarea?.value.trim()) {
                         newSettings.experience.push({
                             id: entry.dataset.id || Date.now() + '_exp' + Math.random(),
                             desc: descTextarea.value.trim()
                         });
                     }
                 });

                 educationContainerEdit?.querySelectorAll('.dynamic-item').forEach(entry => {
                      const schoolInput = entry.querySelector('input[placeholder="请输入学校名称"]');
                      const majorInput = entry.querySelector('input[placeholder="请输入专业名称"]');
                      const degreeInput = entry.querySelector('input[placeholder="请输入学历"]');
                      const timeInput = entry.querySelector('input[placeholder^="例如："]');

                      if (schoolInput?.value.trim() || majorInput?.value.trim() || degreeInput?.value.trim() || timeInput?.value.trim()) {
                          newSettings.education.push({
                              id: entry.dataset.id || Date.now() + '_edu' + Math.random(),
                              school: schoolInput?.value.trim() || '',
                              major: majorInput?.value.trim() || '',
                              degree: degreeInput?.value.trim() || '',
                              time: timeInput?.value.trim() || ''
                          });
                      }
                  });

                 certificatesContainerEdit?.querySelectorAll('.dynamic-item').forEach(entry => {
                     const nameInput = entry.querySelector('input[placeholder="请输入证书名称"]');
                      if (nameInput?.value.trim()) {
                         newSettings.certificates.push({
                             id: entry.dataset.id || Date.now() + '_cert' + Math.random(),
                             name: nameInput.value.trim()
                         });
                      }
                 });

                 otherContactsContainer?.querySelectorAll('.dynamic-item').forEach(entry => {
                      const typeInput = entry.querySelector('input[placeholder^="方式类型"]');
                      const valueInput = entry.querySelector('input[placeholder^="内容/链接"]');
                      const iconInput = entry.querySelector('input[placeholder^="Font Awesome 图标类"]');

                      if (typeInput?.value.trim() || valueInput?.value.trim() || iconInput?.value.trim()) {
                          newSettings.contact.others.push({
                              id: entry.dataset.id || Date.now() + '_con' + Math.random(),
                              type: typeInput?.value.trim() || '',
                              value: valueInput?.value.trim() || '',
                              icon: iconInput?.value.trim() || ''
                          });
                      }
                  });

                currentSettings = newSettings;
                try {
                    localStorage.setItem(SETTINGS_STORAGE_KEY, JSON.stringify(currentSettings));
                    showNotification('设置已成功保存！', 'success');
                    console.log('Settings saved:', currentSettings);
                    updateResumeDisplay(currentSettings);
                } catch (e) {
                    console.error("Error saving settings to localStorage:", e);
                    showNotification('保存设置时出错，请检查浏览器是否支持或空间已满。', 'error');
                }
            }

            // --- Dynamic Entry Creation Functions ---

             function addSkillCategory(category = {}, save = true) {
                 const categoryId = category.id || Date.now() + '_skillcat' + Math.random();
                 const newCategoryDiv = document.createElement('div');
                 newCategoryDiv.classList.add('skill-category');
                 newCategoryDiv.dataset.id = categoryId;
                 newCategoryDiv.innerHTML = `
                    <div class="skill-category-header">
                        <input type="text" class="skill-category-name" value="${category.name || ''}" placeholder="技能类别名称">
                        <div class="skill-category-controls">
                            <button type="button" class="remove-category" aria-label="移除技能类别"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>技能标签</label>
                        <div class="tag-input-container">
                             ${category.tags?.map(tag => `<div class="tag">${tag} <span class="remove-tag" aria-label="移除标签">&times;</span></div>`).join('') || ''}
                            <input type="text" class="tag-input" placeholder="输入技能后按回车添加">
                        </div>
                    </div>
                 `;
                  skillsContainerEdit.appendChild(newCategoryDiv);
                 if (save) { /* saveSettings(); */ }
             }

            function addExperienceEntry(exp = {}, save = true) {
                const entryId = exp.id || Date.now() + '_exp' + Math.random();
                const newEntry = document.createElement('div');
                newEntry.classList.add('dynamic-item', 'project-item');
                newEntry.dataset.id = entryId;
                newEntry.innerHTML = `
                    <button type="button" class="remove-btn" aria-label="移除项目"><i class="fas fa-times"></i></button>
                    <h4>新项目/经历</h4>
                    <div class="form-group">
                        <label>描述 (Markdown)</label>
                        <textarea placeholder="详细描述您的项目或实践经历...">${exp.desc || ''}</textarea>
                         <div class="hint">支持简单的换行、**粗体**、*列表项 (每行一个列表项，列表块用空行分隔)。</div>
                    </div>
                `;
                projectsContainerEdit.appendChild(newEntry);
                if (save) { /* saveSettings(); */ }
            }

             function addEducationEntry(edu = {}, save = true) {
                 const entryId = edu.id || Date.now() + '_edu' + Math.random();
                 const newEntry = document.createElement('div');
                 newEntry.classList.add('dynamic-item', 'education-item');
                 newEntry.dataset.id = entryId;
                 newEntry.innerHTML = `
                     <button type="button" class="remove-btn" aria-label="移除教育经历"><i class="fas fa-times"></i></button>
                      <h4>新的教育经历</h4>
                     <div class="form-group">
                         <label>学校名称</label>
                         <input type="text" placeholder="请输入学校名称" value="${edu.school || ''}">
                     </div>
                     <div class="form-group">
                         <label>专业</label>
                         <input type="text" placeholder="请输入专业名称" value="${edu.major || ''}">
                     </div>
                     <div class="form-group">
                         <label>学历</label>
                         <input type="text" placeholder="请输入学历" value="${edu.degree || ''}">
                     </div>
                     <div class="form-group">
                         <label>在校时间</label>
                         <input type="text" placeholder="例如：2021.09 - 2024.06" value="${edu.time || ''}">
                     </div>
                 `;
                 educationContainerEdit.appendChild(newEntry);
                 if (save) { /* saveSettings(); */ }
             }

             function addCertEntry(cert = {}, save = true) {
                 const entryId = cert.id || Date.now() + '_cert' + Math.random();
                 const newEntry = document.createElement('div');
                 newEntry.classList.add('dynamic-item', 'certificate-item');
                 newEntry.dataset.id = entryId;
                 newEntry.innerHTML = `
                    <button type="button" class="remove-btn" aria-label="移除证书"><i class="fas fa-times"></i></button>
                     <h4>新的证书</h4>
                     <div class="form-group">
                         <label>证书名称</label>
                         <input type="text" placeholder="请输入证书名称" value="${cert.name || ''}">
                     </div>
                 `;
                 certificatesContainerEdit.appendChild(newEntry);
                 if (save) { /* saveSettings(); */ }
             }

             function addOtherContactEntry(other = {}, save = true) {
                 const entryId = other.id || Date.now() + '_con' + Math.random();
                 const newEntry = document.createElement('div');
                 newEntry.classList.add('dynamic-item');
                 newEntry.dataset.id = entryId;
                 newEntry.innerHTML = `
                    <button type="button" class="remove-btn" aria-label="移除联系方式"><i class="fas fa-times"></i></button>
                     <h4>新的联系方式</h4>
                     <div class="form-group">
                         <label>方式类型 (例如：微信, GitHub, 链接)</label>
                         <input type="text" placeholder="例如：GitHub" value="${other.type || ''}">
                     </div>
                     <div class="form-group">
                         <label>内容/链接</label>
                         <input type="text" placeholder="例如：https://github.com/yourusername 或 your_wechat_id" value="${other.value || ''}">
                     </div>
                     <div class="form-group">
                         <label>Font Awesome 图标类 (可选)</label>
                         <input type="text" placeholder="例如：fab fa-github 或 fas fa-globe" value="${other.icon || ''}">
                          <div class="hint">参考: <a href="https://fontawesome.com/icons" target="_blank">fontawesome.com/icons</a> (使用 v6 版本)</div>
                     </div>
                 `;
                 otherContactsContainer.appendChild(newEntry);
                 if (save) { /* saveSettings(); */ }
             }


            // --- Helper Functions ---

            function handleFileUpload(event, previewContainer, placeholderText) {
                const file = event.target.files[0];
                if (file && file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        updateAvatarPreview(e.target.result, previewContainer, placeholderText);
                    }
                    reader.readAsDataURL(file);
                } else if (file) {
                    showNotification('请选择一个图片文件。', 'error');
                }
                 event.target.value = '';
            }

            function updateAvatarPreview(src, previewContainer, placeholderText = '图片预览') {
                 if (previewContainer) {
                     previewContainer.innerHTML = '';

                     if (src) {
                         const img = document.createElement('img');
                         img.src = src;
                         img.alt = placeholderText;
                         img.onerror = () => {
                             console.warn(`Failed to load image: ${src}. Displaying placeholder.`);
                              previewContainer.innerHTML = `<span>${placeholderText}</span>`;
                         };
                         previewContainer.appendChild(img);
                     } else {
                          const span = document.createElement('span');
                          span.textContent = placeholderText;
                          previewContainer.appendChild(span);
                     }
                     previewContainer.dataset.currentSrc = src;
                 }
            }

             function wrapInParagraphs(text) {
                 if (!text) return '';
                 return text.split(/\n\s*\n/).map(p => p.trim()).filter(p => p.length > 0).map(p => `<p>${p}</p>`).join('');
             }


            function createSidebarContactLi(iconClass, href, innerHTML, target = null, rel = null, id = null) {
                const li = document.createElement('li');
                 if (id === 'wechat-trigger-sidebar') {
                     li.classList.add('sidebar-wechat-trigger');
                 } else {
                     li.id = id || '';
                 }

                const i = document.createElement('i');
                i.className = iconClass;
                li.appendChild(i);

                const contentElement = (href && href !== 'javascript:void(0);') ? document.createElement('a') : document.createElement('span');
                contentElement.innerHTML = innerHTML;

                if (contentElement.tagName === 'A') {
                    contentElement.href = href;
                    if (target) contentElement.target = target;
                    if (rel) contentElement.rel = rel;
                }
                li.appendChild(contentElement);

                return li;
            }

             function createMainContactLi(iconClass, href, text, target = null, rel = null, isWechat = false) {
                const li = document.createElement('li');
                const i = document.createElement('i');
                i.className = iconClass;

                if (isWechat) {
                    li.classList.add('wechat-hover-trigger');
                    li.innerHTML = `
                        <i class="${iconClass}"></i>
                        <span>${text}</span>
                        <div class="wechat-tooltip">
                             <img src="${currentSettings.contact?.wechatQr || 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7'}" alt="微信二维码">
                             <span>微信扫码联系我</span>
                        </div>
                    `;
                 } else if (href && href !== 'javascript:void(0);') {
                     const a = document.createElement('a');
                     a.href = href;
                     a.textContent = text;
                     if (target) a.target = target;
                     if (rel) a.rel = rel;
                     li.appendChild(i);
                     li.appendChild(a);
                 } else {
                     const span = document.createElement('span');
                     span.textContent = text;
                     li.appendChild(i);
                     li.appendChild(span);
                 }
                return li;
            }

             function showNotification(message, type = 'success') {
                 if (notificationElement) {
                     if (notificationElement.dataset.timeoutId) {
                         clearTimeout(parseInt(notificationElement.dataset.timeoutId));
                     }

                     notificationElement.textContent = message;
                     notificationElement.className = `notification ${type}`;
                     notificationElement.style.display = 'block';

                     const timeoutId = setTimeout(() => {
                         notificationElement.style.display = 'none';
                         notificationElement.dataset.timeoutId = '';
                     }, 3000);
                      notificationElement.dataset.timeoutId = timeoutId.toString();
                 } else {
                      alert(message);
                 }
             }


            // --- Event Listeners ---

            // Initial Load - Load settings and update display
            loadSettings(); // Load settings and update display first

            // Get the settings page element for delegation
            const settingsPageElement = document.getElementById('settings-page');

            if (settingsForm && settingsPageElement) {

                // --- Event Delegation for REMOVE buttons and TAG INPUTS on settings page ---
                settingsPageElement.addEventListener('click', function(event) {
                    const removeBtn = event.target.closest('.remove-btn');
                    if (removeBtn) {
                        event.preventDefault();
                        const itemToRemove = removeBtn.closest('.dynamic-item');
                        if (itemToRemove && confirm('确定要移除此项吗？')) {
                             itemToRemove.remove();
                             // Note: Changes are saved only on form submit or header save button click
                        }
                        return;
                    }

                    const removeCategoryBtn = event.target.closest('.remove-category');
                    if (removeCategoryBtn) {
                         event.preventDefault();
                         const categoryToRemove = removeCategoryBtn.closest('.skill-category');
                         if (categoryToRemove && confirm('确定要移除此技能类别吗？')) {
                              categoryToRemove.remove();
                         }
                        return;
                    }

                    const removeTagSpan = event.target.closest('.remove-tag');
                    if (removeTagSpan) {
                         event.preventDefault();
                         const tagToRemove = removeTagSpan.closest('.tag');
                         if (tagToRemove) {
                              tagToRemove.remove();
                         }
                        return;
                    }
                });

                 settingsPageElement.addEventListener('keypress', function(e) {
                     const target = e.target;
                     if (target.tagName === 'INPUT' && target.classList.contains('tag-input') && e.key === 'Enter' && target.value.trim() !== '') {
                         e.preventDefault();
                         const tagText = target.value.trim();
                         const tagContainer = target.parentElement;

                         const newTag = document.createElement('div');
                         newTag.classList.add('tag');
                         newTag.innerHTML = `${tagText} <span class="remove-tag" aria-label="移除标签">&times;</span>`;

                         tagContainer.insertBefore(newTag, target);

                         target.value = '';
                     }
                 });
                // --- End of Event Delegation ---


                // Header Save Button Listener
                if (settingsSaveButtonHeader) {
                    settingsSaveButtonHeader.addEventListener('click', (e) => {
                        e.preventDefault();
                        saveSettings();
                    });
                }

                 // Listen for form submission on the form itself - this might be triggered by Enter key in certain inputs
                 // If you want Enter key to submit, ensure your save button is the default submit button or handle it explicitly.
                 // Since we removed the bottom submit button, Enter might not trigger save automatically unless linked.
                 // Keeping form submit handler just in case, but the header button is the primary save action.
                 settingsForm.addEventListener('submit', (e) => {
                     e.preventDefault();
                     // Optionally call saveSettings() here if you want any submit action to save.
                     // Or do nothing if only the header button should save.
                     // saveSettings(); // Uncomment if you want Enter key to save
                     console.log("Form submitted, but saveSettings not called automatically by submit handler.");
                 });


                // Avatar Upload
                if (avatarUploadInput) {
                    avatarUploadInput.addEventListener('change', (e) => handleFileUpload(e, avatarPreviewContainer, '头像预览'));
                }
                 // WeChat QR Upload
                if (wechatQrUploadInput) {
                    wechatQrUploadInput.addEventListener('change', (e) => handleFileUpload(e, wechatQrPreviewContainer, '二维码预览'));
                 }

                // "Add" Buttons (These don't need delegation, attach directly)
                if (addSkillCategoryBtn) addSkillCategoryBtn.addEventListener('click', (e) => { e.preventDefault(); addSkillCategory(); });
                if (addProjectBtn) addProjectBtn.addEventListener('click', (e) => { e.preventDefault(); addExperienceEntry(); });
                if (addEducationBtn) addEducationBtn.addEventListener('click', (e) => { e.preventDefault(); addEducationEntry(); });
                if (addCertificateBtn) addCertificateBtn.addEventListener('click', (e) => { e.preventDefault(); addCertEntry(); });
                 if (addOtherContactBtn) addOtherContactBtn.addEventListener('click', (e) => { e.preventDefault(); addOtherContactEntry(); });


                // Placeholder Buttons
                if (resumeParseBtn) {
                    resumeParseBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        showNotification('简历解析功能暂未开放，敬请期待！', 'info');
                    });
                }
                 if (customCssBtn) {
                    customCssBtn.addEventListener('click', (e) => {
                        e.preventDefault();
                        showNotification('自定义 CSS 功能暂未开放，敬请期待！', 'info');
                    });
                 }

                // "不使用模板" checkbox logic
                if (useMarkdownCheckbox && markdownEditorSection) {
                     useMarkdownCheckbox.addEventListener('change', function() {
                         const isChecked = this.checked;
                         markdownEditorSection.style.display = isChecked ? 'block' : 'none';
                         // You might want to disable/enable other form sections here too
                     });
                      // Initialize state on load with a slight delay
                     setTimeout(() => {
                          useMarkdownCheckbox.dispatchEvent(new Event('change'));
                     }, 50);
                }


            } else {
                 console.error("Required settings elements (form or settings page div) not found!");
            }

        }); // End DOMContentLoaded
    </script>

</body>
</html>
